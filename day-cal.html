<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>한국 시간 배지 생성기</title>
</head>
<body>
    <script>
        // 한국 시간 기준 현재 시각 반환
        function getKoreanTime() {
            const now = new Date();
            const utc = now.getTime() + (now.getTimezoneOffset() * 60 * 1000);
            const koreaTimeDiff = 9 * 60 * 60 * 1000;
            return new Date(utc + koreaTimeDiff);
        }

        // type에 따라 날짜 또는 시간 계산 및 디버깅 로그 출력
        function calculateTargetDate(type, value) {
            const now = getKoreanTime();
            const numValue = Number(value);
            console.log('calculateTargetDate 호출:', { type, value, numValue, now: now.toISOString() });

            if (type === "date") {
                const targetDate = new Date(now);
                targetDate.setDate(targetDate.getDate() + numValue);
                console.log('계산된 targetDate (date):', targetDate.toISOString());
                return targetDate;
            } else if (type === "time") { 
                const targetDate = new Date(now.getTime() + numValue * 60 * 60 * 1000);
                return targetDate;
            } else {
                return now;
            }
        }

        // 날짜에서 요일 이름과 숫자 반환 (일=1, 토=7)
        function getDayOfWeek(date) {
            const dayNames = ["일", "월", "화", "수", "목", "금", "토"];
            const dayNumbers = [1, 2, 3, 4, 5, 6, 7];
            const dayIndex = date.getDay();
            return {
                name: dayNames[dayIndex],
                number: dayNumbers[dayIndex],
            };
        }

        // YYYY.MM.DD 포맷으로 날짜 변환
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, "0");
            const day = String(date.getDate()).padStart(2, "0");
            return `${year}.${month}.${day}`;
        }

        // HH:mm 포맷으로 시간 변환
        function formatTime(date) {
            const hours = String(date.getHours()).padStart(2, "0");
            const minutes = String(date.getMinutes()).padStart(2, "0");
            return `${hours}:${minutes}`;
        }

        // 날짜 범위를 줄바꿈 포함 문자열로 반환
        function getDateRange(baseDate, endDate) {
            return `${formatDate(baseDate)}\n${formatDate(endDate)}`;
        }

        // 날짜와 시간을 줄바꿈 포함 문자열로 반환
        function getTimeResult(endTime) {
            return `${formatDate(endTime)}\n${formatTime(endTime)}`;
        }

        // 요일에 맞는 색상 반환
        function getDayColor(dayNumber) {
            const colors = {
                1: "#ff6b6b", // 일요일 빨강
                2: "#4ecdc4", // 월요일 청록
                3: "#45b7d1", // 화요일 파랑
                4: "#96ceb4", // 수요일 초록
                5: "#feca57", // 목요일 노랑
                6: "#ff9ff3", // 금요일 분홍
                7: "#a55eea", // 토요일 보라
            };
            return colors[dayNumber] || "#6c757d";
        }

        // SVG 배지 생성
        function generateBadge(type, value) {
            console.log('generateBadge 호출:', { type, value });
            const koreanTime = getKoreanTime();
            const targetTime = calculateTargetDate(type, value);
            const dayInfo = getDayOfWeek(targetTime);

            let leftText = `${dayInfo.number} ${dayInfo.name}`;
            let rightText = "";
            let leftColor = getDayColor(dayInfo.number);
            let rightColor = "#ffffff";
            let textColor = "#000000";

            if (type === "date") {
                rightText = getDateRange(koreanTime, targetTime);
            } else if (type === "time") {
                rightText = getTimeResult(targetTime)
            }

            const leftWidth = 60;
            const rightWidth = 90;
            const totalWidth = leftWidth + rightWidth;
            const badgeHeight = 50;

            const svg = `
                <svg xmlns="http://www.w3.org/2000/svg" width="${totalWidth}" height="${badgeHeight}">
                    <defs>
                        <linearGradient id="gradient" x1="0%" y1="0%" x2="0%" y2="100%">
                            <stop offset="0%" style="stop-color:#ffffff; stop-opacity:0.1" />
                            <stop offset="100%" style="stop-color:#000000; stop-opacity:0.1" />
                        </linearGradient>
                    </defs>
                    <!-- 좌측 배경 (요일) -->
                    <rect x="0" y="0" width="${leftWidth}" height="${badgeHeight}" fill="${leftColor}" />
                    <!-- 우측 배경 (내용) -->
                    <rect x="${leftWidth}" y="0" width="${rightWidth}" height="${badgeHeight}" fill="${rightColor}" />
                    <!-- 그라디언트 오버레이 -->
                    <rect x="0" y="0" width="${totalWidth}" height="${badgeHeight}" fill="url(#gradient)" />
                    <!-- 좌측 텍스트 (요일) -->
                    <text x="${leftWidth / 2}" y="${badgeHeight / 2 + 6}"
                          font-family="Verdana, Geneva, DejaVu Sans, sans-serif"
                          font-size="14"
                          font-weight="bold"
                          fill="#ffffff"
                          text-anchor="middle">${leftText}</text>
                    <!-- 우측 텍스트 (내용) -->
                    ${
                        rightText.includes("\n")
                            ? rightText
                                  .split("\n")
                                  .map(
                                      (line, index) =>
                                          `<text x="${
                                              leftWidth + rightWidth / 2
                                          }" y="${badgeHeight / 2 + index * 12 - 4}"
                                               font-family="Verdana, Geneva, DejaVu Sans, sans-serif"
                                               font-size="10"
                                               fill="${textColor}"
                                               text-anchor="middle">${line}</text>`
                                  )
                                  .join("\n")
                            : `<text x="${leftWidth + rightWidth / 2}" y="${badgeHeight / 2 + 6}"
                                      font-family="Verdana, Geneva, DejaVu Sans, sans-serif"
                                      font-size="12"
                                      fill="${textColor}"
                                      text-anchor="middle">${rightText}</text>`
                    }
                </svg>
            `;
            return svg;
        }

        // 페이지 요청 처리
        function handleRequest() {
            const urlParams = new URLSearchParams(window.location.search);
            const typeRaw = urlParams.get("type") || "date";
            const type = typeRaw.toLowerCase();  // 소문자 변환 보장
            const value = Number(urlParams.get("value")) || 1;

            const svgContent = generateBadge(type, value);

            document.body.innerHTML = "";
            document.write(svgContent);
            document.close();

            if (document.querySelector("svg")) {
                const meta = document.createElement("meta");
                meta.httpEquiv = "Content-Type";
                meta.content = "image/svg+xml";
                document.head.appendChild(meta);
            }
        }

        window.onload = handleRequest;
    </script>
</body>
</html>
